name: Deploy BedulTech Apps

on:
  push:
    branches: ["dev", "main"]

jobs:
  deploy:
    runs-on: self-hosted
    # Pastikan user runner punya izin tulis ke folder target

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      # --- LOGIC UNTUK BRANCH DEV ---
      - name: Deploy to DEV Environment
        if: github.ref == 'refs/heads/dev'
        run: |
          echo "ðŸš€ Starting deployment to DEV..."

          # Gunakan rsync dengan --delete untuk sinkronisasi (bukan hapus paksa)
          # Folder tujuan disesuaikan dengan struktur Ansible kita
          rsync -av --delete --exclude='.git' --exclude='.github' ./src/ $HOME/bedultech/apps/dev/

          echo "âœ… Deployment to DEV success! Check at https://dev.bedultech.my.id"

      # --- LOGIC UNTUK BRANCH MAIN (PROD) ---
      - name: Deploy to PROD Environment
        if: github.ref == 'refs/heads/main'
        run: |
          echo "ðŸš€ Starting deployment to PROD..."

          rsync -av --delete --exclude='.git' --exclude='.github' ./src/ $HOME/bedultech/apps/prod/

          echo "âœ… Deployment to PROD success! Check at https://bedultech.my.id"
