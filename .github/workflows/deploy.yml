name: Deploy Simple Compro

on:
  push:
    branches: ["dev", "main"]

jobs:
  deploy:
    runs-on: self-hosted

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      # --- LOGIC UNTUK BRANCH DEV ---
      - name: Deploy to DEV Environment
        if: github.ref == 'refs/heads/dev'
        run: |
          echo "ðŸš€ Starting deployment to DEV..."
          
          # 1. Bersihkan folder tujuan di VM
          rm -rf /home/kaptenbedul/bedultech/apps/dev/*
          
          # 2. Copy semua file dari repo ke folder tujuan
          # --exclude .git: supaya folder git tidak ikut ke-copy
          rsync -av --exclude='.git' --exclude='.github' ./src/ /home/kaptenbedul/bedultech/apps/dev/
          
          echo "âœ… Deployment to DEV success! Check at port 8080"

      # --- LOGIC UNTUK BRANCH MAIN (PROD) ---
      - name: Deploy to PROD Environment
        if: github.ref == 'refs/heads/main'
        run: |
          echo "ðŸš€ Starting deployment to PROD..."
          
          # 1. Bersihkan folder tujuan di VM
          rm -rf /home/kaptenbedul/bedultech/apps/prod/*
          
          # 2. Copy semua file dari repo ke folder tujuan
          rsync -av --exclude='.git' --exclude='.github' ./src/ /home/kaptenbedul/bedultech/apps/prod/
          
          echo "âœ… Deployment to PROD success! Check at port 80"